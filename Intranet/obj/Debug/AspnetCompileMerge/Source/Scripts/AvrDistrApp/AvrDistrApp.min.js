"use strict";var app=new Marionette.Application;Marionette.TemplateCache.prototype.compileTemplate=function(n){return Handlebars.compile(n)};app.addRegions({header:"#header",main:"#app",dialog:"#dialog"});app.on("start",function(){console.log("Hello world");var n=new app.Views.Header;app.header.show(n);Backbone.history.start();app.recipients=new app.Models.Recipients;app.recipients.fetch({error:function(){alert("There is an error while getting recipients collection")}}).done(function(){var n=new app.Views.ListView({collection:app.recipients});app.main.show(n)});app.on("recipient:add",function(n){app.recipients.create(n,{wait:!0})});app.on("recipient:delete",function(n){n&&console.log(n.destroy({wait:!0}))});app.on("setFilter",function(n){var t=new app.Views.ListView({collection:app.recipients,filterText:n.toLowerCase()});app.main.show(t)})});$(function(){app.start()});app.module("Models",function(n,t,i){n.Recipient=i.Model.extend({idAttribute:"Id",methodToURL:function(n,t){return n=="create"?"post":n=="update"?"put":n=="delete"?"delete/"+t:"get"},sync:function(n,t,r){return r=r||{},r.url=this.methodToURL(n.toLowerCase(),this.id),i.sync(n,t,r)}});n.Recipients=i.Collection.extend({model:n.Recipient,url:"get",comparator:function(n){return n.get("Name")}})});app.module("Views",function(n,t,i,r,u){n.ItemView=r.ItemView.extend({template:"#recipient-template",tagName:"tr",events:{"click .toggle":"toggleEnabled","click .destroy":"del","click td":"edit"},edit:function(){var n=new app.Views.DialogView({model:this.model});app.dialog.show(n);u("#dialog").modal()},del:function(n){n.stopPropagation();t.trigger("recipient:delete",this.model)},toggleEnabled:function(n){n.stopPropagation();var t=this.model.get("Enabled"),i=this;this.model.save({Enabled:!t},{wait:!0,error:function(){i.model.trigger("change")}})},modelEvents:{change:"render"}});n.ListView=r.CompositeView.extend({template:"#recipients-template",childView:n.ItemView,childViewContainer:"tbody",filter:function(n){if(!this.options.filterText)return!0;var t=!1;return n.get("Name")&&(t=t||n.get("Name").toLowerCase().indexOf(this.options.filterText)>-1),n.get("RukOtdelaEmail")&&(t=t||n.get("RukOtdelaEmail").toLowerCase().indexOf(this.options.filterText)>-1),n.get("RukFillialaEmail")&&(t=t||n.get("RukFillialaEmail").toLowerCase().indexOf(this.options.filterText)>-1),n.get("POROREmail")&&(t=t||n.get("POROREmail").toLowerCase().indexOf(this.options.filterText)>-1),t}});n.DialogView=r.ItemView.extend({template:"#modal_content_with_close_btn",events:{"click #save":function(n){n.preventDefault();var r=i.Syphon.serialize(this);this.model?this.model.save(r,{wait:!0,error:function(){alert("Извините, произошла ошибка сохранения.")}}):t.trigger("recipient:add",r)},"keyup input":"preValidate"},modelEvents:{invalid:"showInvalid"},showInvalid:function(n,t){for(var i in t)u("[name='"+i+"Error']").html(t[i])},preValidate:function(){this.model.trigger("validate")}});n.Header=r.ItemView.extend({template:"#header-template",ui:{search:".search-query"},events:{"click #create-new":"showCreate","keyup @ui.search":"filterList"},showCreate:function(){var n=new app.Views.DialogView;app.dialog.show(n);u("#dialog").modal()},filterList:function(){var n=u(this.ui.search).val();t.trigger("setFilter",n)}})});
//# sourceMappingURL=AvrDistrApp.min.js.map
