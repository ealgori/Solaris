Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(n){return Handlebars.compile(n)};var App=Marionette.Application.extend({});window.app=new App;app.addRegions({ddMenu:".ddmenu",detailsRegion:"#details",itemsRegion:"#items-list",matItemsRegion:"#matitems-list"});app.on("start",function(){var n=new app.Route.Controller;app.Prices=new app.Entities.PriceItemCollection;app.TestModel=new app.Entities.DetailModel;app.TestModel.url=app.TestModel.baseUrl});app.on("before:start",function(){});$(function(){app.start();Backbone.history.start()});app.module("Entities",function(n,t,i){n.AvrModel=i.Model.extend({defaults:{text:"",value:"0"}});n.AvrCollection=i.Collection.extend({url:"/Json/TOList"});n.DetailModel=i.Model.extend({baseUrl:"/TO/GetTODataByIdGet?"});n.ItemModel=i.Model.extend({defaults:{Site:0,SiteAddress:0,Type:"не указан",SiteQuantity:0,TOItem:0,Price:0,Total:0,selected:!1},toggle:function(){var n=this.get("selected");this.set("selected",!n)}});n.ItemCollection=i.Collection.extend({});n.PriceItem=i.Model.extend({defaults:{text:"no text",value:"no value"}});n.PriceItemCollection=i.Collection.extend({url:"/Json/TOPositionListGet"})});app.module("Route",function(n,t,i,r){n.Controller=r.Controller.extend({initialize:function(){console.log("controller init");this.router=new n.Router({controller:this});var i=new t.Entities.AvrCollection,r=new t.Views.AvrView({collection:i});i.fetch({success:function(){r.render()}})},index:function(){var n=new t.Entities.DetailModel({Status:"error",Message:"Пожалуйста выберите ТО"}),i=new t.Views.DetailPanelView({model:n});app.detailsRegion.show(i)},showTo:function(n){var i=new t.Entities.DetailModel;i.url=i.baseUrl+$.param({TOId:n});t.currentTO=n;i.fetch({beforeSend:function(){console.log("loading details")},success:function(n){var i,r,u,f;n.get("Message")?(i=new t.Views.DetailPanelView({model:n}),app.detailsRegion.show(i)):(r=new t.Views.DetialView({model:n}),app.detailsRegion.show(r),u=new t.Entities.ItemCollection(n.get("Items")),f=new t.Views.ItemsView({collection:u}),f.render())}}).done(function(){});console.log("to"+n)}});n.Router=r.AppRouter.extend({appRoutes:{"":"index","to/:to":"showTo"}})});app.module("Views",function(n,t,i,r){n.AvrView=r.ItemView.extend({template:"#to-combo-template",el:"#to",onRender:function(){this.$el.find("#to-select").combobox()},events:{"change #to-select":"navigate"},navigate:function(n){var t=n.currentTarget,r=$(t).val();i.history.navigate(r,{trigger:!0})}});n.DetailPanelView=r.ItemView.extend({template:"#detail-panel-template"});n.DetialView=r.ItemView.extend({template:"#detail-template",modelEvents:{all:"render"},onRender:function(){}});n.ItemView=r.ItemView.extend({template:"#row-template",events:{"click .view":"editing","click #check":"check","keyup .edit":"cancellEditing"},check:function(n){var t,i;n.preventDefault();t=this.model.get("selected");t===undefined&&(t=!1);i=this.model.get("Site");this.model.collection.each(function(n){var r=n.get("Site");i==r&&n.set("selected",!t)})},editing:function(){this.$el.addClass("editing")},setPrice:function(n){var i=t.Prices.findWhere({value:parseInt(n)});this.model.set("TOItemText",i.get("text"));this.model.set("ItemId",i.get("value"));console.log(i);this.$el.removeClass("editing")},cancellEdit:function(){this.$el.removeClass("editing")},finishEditing:function(n){var t=$(n.currentTarget).find("select").val(),i=app.Prices.findWhere({"":t});this.model.set("TOItem",t);this.$el.removeClass("editing")},cancelEditing:function(n){console.log(n);this.$el.children(".select").toggleClass("editing")},modelEvents:{all:"render"},onRender:function(){},tagName:"tr"});n.ItemsView=r.CollectionView.extend({el:"#items-list",childView:n.ItemView,prefill:!0,prefillSuccess:function(){console.log("prefill:"+t.TestModel.get("Brunch"))},emptyView:n.ItemEmptyView,collectionEvents:{reset:"render"},isEmpty:function(){return this.collection.length==0}});n.ItemEmptyView=r.ItemView.extend({template:"#row-empty-template"});n.PricesView=r.ItemView.extend({template:"#prices-view-template",onBeforeAttach:function(){},collectionEvents:{sync:"render"},ui:{select:"select"},events:{"change @ui.select":"selected","focusout .edit":"cancellEdit"},selected:function(n){t.trigger("price:selected",n.currentTarget.value)},cancellEdit:function(){console.log("focusOut");t.trigger("price:cancell")},onRender:function(){}})});
//# sourceMappingURL=ToCreation.min.js.map
